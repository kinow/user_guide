
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Scattering Workflows &#8212; Common Workflow Language User Guide 0.1 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Conditional workflows" href="../24_conditional-workflow/index.html" />
    <link rel="prev" title="Nested Workflows" href="../22-nested-workflows/index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="16x16" href="../_static/images/favicons/cwl/favicon-16x16.png">
      
    
      
      <link rel="icon" sizes="32x32" href="../_static/images/favicons/cwl/favicon-32x32.png">
      
    
      
      <link rel="icon" sizes="96x96" href="../_static/images/favicons/cwl/favicon-96x96.png">
      
    
      
      <link rel="icon" sizes="128x128" href="../_static/images/favicons/cwl/favicon-128.png">
      
    
      
      <link rel="icon" sizes="196x196" href="../_static/images/favicons/cwl/favicon-196x196.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/CWL-Logo-HD-cropped2.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../CODE_OF_CONDUCT.html">
  Code of Conduct
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../setup.html">
  Setup
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../episodes.html">
  Episodes
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../extras.html">
  Extras
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../LICENSE.html">
  Licenses
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links d-none d-md-block" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01-introduction/index.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-1st-example/index.html">
   First Example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-input/index.html">
   Essential Input Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04-output/index.html">
   Returning Output Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05-stdout/index.html">
   Capturing Standard Output
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06-params/index.html">
   Parameter References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07-containers/index.html">
   Running Tools Inside Docker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../08-arguments/index.html">
   Additional Arguments and Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../09-array-inputs/index.html">
   Array Inputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10-array-outputs/index.html">
   Array Outputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11-records/index.html">
   Advanced Inputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../12-env/index.html">
   Environment Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../13-expressions/index.html">
   JavaScript Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../14-runtime/index.html">
   Creating Files at Runtime
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../15-staging/index.html">
   Staging Input Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../16-file-formats/index.html">
   File Formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../17-metadata/index.html">
   Metadata and Authorship
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../19-custom-types/index.html">
   Custom Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20-software-requirements/index.html">
   Specifying Software Requirements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../21-1st-workflow/index.html">
   Writing Workflows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../22-nested-workflows/index.html">
   Nested Workflows
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Scattering Workflows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../24_conditional-workflow/index.html">
   Conditional workflows
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/common-workflow-language/user_guide/edit/gh-pages/23-scatter-workflow/index.md">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="scattering-workflows">
<h1>Scattering Workflows<a class="headerlink" href="#scattering-workflows" title="Permalink to this headline">#</a></h1>
<p>Now that we know how to write workflows, we can start utilizing the <code class="docutils literal notranslate"><span class="pre">ScatterFeatureRequirement</span></code>.
This feature tells the runner that you wish to run a tool or workflow multiple times over a list
of inputs. The workflow then takes the input(s) as an array and will run the specified step(s)
on each element of the array as if it were a single input. This allows you to run the same workflow
on multiple inputs without having to generate many different commands or input yaml files.</p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="nt">requirements</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">ScatterFeatureRequirement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>
</pre></div>
</div>
<p>The most common reason a new user might want to use scatter is to perform the same analysis on
different samples. Let’s start with a simple workflow that calls our first example and takes
an array of strings as input to the workflow:</p>
<p><em>scatter-workflow.cwl</em></p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env cwl-runner</span><span class="w"></span>

<span class="nt">cwlVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0</span><span class="w"></span>
<span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Workflow</span><span class="w"></span>

<span class="nt">requirements</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">ScatterFeatureRequirement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>

<span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">message_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string[]</span><span class="w"> </span>

<span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">echo</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1st-tool.cwl</span><span class="w"></span>
<span class="w">    </span><span class="nt">scatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message</span><span class="w"></span>
<span class="w">    </span><span class="nt">in</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message_array</span><span class="w"></span>
<span class="w">    </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>

<span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
<p>Aside from the <code class="docutils literal notranslate"><span class="pre">requirements</span></code> section including <code class="docutils literal notranslate"><span class="pre">ScatterFeatureRequirement</span></code>, what is
going on here?</p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">message_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string[]</span><span class="w"></span>
</pre></div>
</div>
<p>First of all, notice that the main workflow level input here requires an array of strings.</p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">echo</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1st-tool.cwl</span><span class="w"></span>
<span class="w">    </span><span class="nt">scatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message</span><span class="w"></span>
<span class="w">    </span><span class="nt">in</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message_array</span><span class="w"></span>
<span class="w">    </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
<p>Here we’ve added a new field to the step <code class="docutils literal notranslate"><span class="pre">echo</span></code> called <code class="docutils literal notranslate"><span class="pre">scatter</span></code>. This field tells the
runner that we’d like to scatter over this input for this particular step. Note that
the input name listed after scatter is the one of the step’s input, not a workflow level input.</p>
<p>For our first scatter, it’s as simple as that! Since our tool doesn’t collect any outputs, we
still use <code class="docutils literal notranslate"><span class="pre">outputs:</span> <span class="pre">[]</span></code> in our workflow, but if you expect that the final output of your
workflow will now have multiple outputs to collect, be sure to update that to an array type
as well!</p>
<p>Using the following input file:</p>
<p><em>scatter-job.yml</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">message_array</span><span class="p">:</span><span class="w"> </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Hello world!</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Hola mundo!</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Bonjour le monde!</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Hallo welt!</span><span class="w"></span>
</pre></div>
</div>
<p>As a reminder, <code class="docutils literal notranslate"><span class="pre">1st-tool.cwl</span></code> simply calls the command <code class="docutils literal notranslate"><span class="pre">echo</span></code> on a message. If we invoke
<code class="docutils literal notranslate"><span class="pre">cwl-runner</span> <span class="pre">scatter-workflow.cwl</span> <span class="pre">scatter-job.yml</span></code> on the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cwl-runner scatter-workflow.cwl scatter-job.yml
<span class="o">[</span>workflow scatter-workflow.cwl<span class="o">]</span> start
<span class="o">[</span>step echo<span class="o">]</span> start
<span class="o">[</span>job echo<span class="o">]</span> /tmp/tmp0hqmg400$ <span class="nb">echo</span> <span class="se">\</span>
    <span class="s1">&#39;Hello world!&#39;</span>
Hello world!
<span class="o">[</span>job echo<span class="o">]</span> completed success
<span class="o">[</span>step echo<span class="o">]</span> start
<span class="o">[</span>job echo_2<span class="o">]</span> /tmp/tmpu65_m1zw$ <span class="nb">echo</span> <span class="se">\</span>
    <span class="s1">&#39;Hola mundo!&#39;</span>
Hola mundo!
<span class="o">[</span>job echo_2<span class="o">]</span> completed success
<span class="o">[</span>step echo<span class="o">]</span> start
<span class="o">[</span>job echo_3<span class="o">]</span> /tmp/tmp5cs7a2wh$ <span class="nb">echo</span> <span class="se">\</span>
    <span class="s1">&#39;Bonjour le monde!&#39;</span>
Bonjour le monde!
<span class="o">[</span>job echo_3<span class="o">]</span> completed success
<span class="o">[</span>step echo<span class="o">]</span> start
<span class="o">[</span>job echo_4<span class="o">]</span> /tmp/tmp301wo7p8$ <span class="nb">echo</span> <span class="se">\</span>
    <span class="s1">&#39;Hallo welt!&#39;</span>
Hallo welt!
<span class="o">[</span>job echo_4<span class="o">]</span> completed success
<span class="o">[</span>step echo<span class="o">]</span> completed success
<span class="o">[</span>workflow scatter-workflow.cwl<span class="o">]</span> completed success
<span class="o">{}</span>
Final process status is success
</pre></div>
</div>
<p>You can see that the workflow calls echo multiple times on each element of our
<code class="docutils literal notranslate"><span class="pre">message_array</span></code>. Ok, so how about if we want to scatter over two steps in a workflow?</p>
<p>Let’s perform a simple echo like above, but capturing <code class="docutils literal notranslate"><span class="pre">stdout</span></code> by adding the following
lines instead of <code class="docutils literal notranslate"><span class="pre">outputs:</span> <span class="pre">[]</span></code></p>
<p><em>1st-tool-mod.cwl</em></p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="nt">outputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">echo_out</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdout</span><span class="w"></span>
</pre></div>
</div>
<p>And add a second step that uses <code class="docutils literal notranslate"><span class="pre">wc</span></code> to count the characters in each file. See the tool
below:</p>
<p><em>wc-tool.cwl</em></p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env cwl-runner</span><span class="w"></span>

<span class="nt">cwlVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0</span><span class="w"></span>
<span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CommandLineTool</span><span class="w"></span>
<span class="nt">baseCommand</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wc</span><span class="w"></span>
<span class="nt">arguments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">input_file</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">File</span><span class="w"></span>
<span class="w">    </span><span class="nt">inputBinding</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
<p>Now, how do we incorporate scatter? Remember the scatter field is under each step:</p>
<p><em>scatter-two-steps.cwl</em></p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env cwl-runner</span><span class="w"></span>

<span class="nt">cwlVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0</span><span class="w"></span>
<span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Workflow</span><span class="w"></span>

<span class="nt">requirements</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="nt">ScatterFeatureRequirement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>

<span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">message_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string[]</span><span class="w"> </span>

<span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">echo</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1st-tool-mod.cwl</span><span class="w"></span>
<span class="w">    </span><span class="nt">scatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message</span><span class="w"></span>
<span class="w">    </span><span class="nt">in</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message_array</span><span class="w"></span>
<span class="w">    </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">echo_out</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">  </span><span class="nt">wc</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wc-tool.cwl</span><span class="w"></span>
<span class="w">    </span><span class="nt">scatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">input_file</span><span class="w"></span>
<span class="w">    </span><span class="nt">in</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">input_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo/echo_out</span><span class="w"></span>
<span class="w">    </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>

<span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
<p>Here we have placed the scatter field under each step. This is fine for this example since
it runs quickly, but if you’re running many samples for a more complex workflow, you may
wish to consider an alternative. Here we are running scatter on each step independently, but
since the second step is not dependent on the first step completing all languages, we aren’t
using the scatter functionality efficiently. The second step expects an array as input from
the first step, so it will wait until everything in step one is finished before doing anything.
Pretend that <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">Hello</span> <span class="pre">World!</span></code> takes 1 minute to perform, <code class="docutils literal notranslate"><span class="pre">wc</span> <span class="pre">-c</span></code> on the output takes 3 minutes
and that <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">Hallo</span> <span class="pre">welt!</span></code> takes 5 minutes to perform, and <code class="docutils literal notranslate"><span class="pre">wc</span></code> on that output takes 3 minutes.
Even though <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">Hello</span> <span class="pre">World!</span></code> could finish in 4 minutes, it will actually finish in 8 minutes
because the first step must wait on <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">Hallo</span> <span class="pre">welt!</span></code>. You can see how this might not scale
well.</p>
<p>Ok, so how do we scatter on steps that can proceed independent of other samples? Remember from
<a class="reference internal" href="../22-nested-workflows/index.html"><span class="doc std std-doc">chapter 21</span></a>, that we can make an entire workflow a single step in another workflow! Convert our
two step workflow to a single step subworkflow:</p>
<p><em>scatter-nested-workflow.cwl</em></p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env cwl-runner</span><span class="w"></span>

<span class="nt">cwlVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0</span><span class="w"></span>
<span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Workflow</span><span class="w"></span>

<span class="nt">requirements</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="nt">ScatterFeatureRequirement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>
<span class="w"> </span><span class="nt">SubworkflowFeatureRequirement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>

<span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">message_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string[]</span><span class="w"> </span>

<span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">subworkflow</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Workflow</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w"></span>
<span class="w">      </span><span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
<span class="w">      </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">echo</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1st-tool-mod.cwl</span><span class="w"></span>
<span class="w">          </span><span class="nt">in</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message</span><span class="w"></span>
<span class="w">          </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">echo_out</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">        </span><span class="nt">wc</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wc-tool.cwl</span><span class="w"></span>
<span class="w">          </span><span class="nt">in</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">input_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo/echo_out</span><span class="w"></span>
<span class="w">          </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
<span class="w">    </span><span class="nt">scatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message</span><span class="w"></span>
<span class="w">    </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message_array</span><span class="w"></span>
<span class="w">    </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
<span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>
</pre></div>
</div>
<p>Now the scatter acts on a single step, but that step consists of two steps so each step is performed
in parallel.</p>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../22-nested-workflows/index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Nested Workflows</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../24_conditional-workflow/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Conditional workflows</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>

<div class="container">
  <div class="row">
    <div class="col d-flex flex-row-reverse">
      <ul class="nav">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/">Source</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/blob/gh-pages/CITATION">Cite</a>
        </li>
      </ul>
    </div>
  </div>
</div>

<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2013, CWL Project Team.<br>
</p>
    </div>
    
  </div>
</footer>

  </body>
</html>